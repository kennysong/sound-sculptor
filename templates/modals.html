<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Sound Sculptor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="../static/css/main.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="../static/css/bootstrap-metro.min.css" rel="stylesheet">


    <script>
      function changeTo (newHero) {
        var heros = ['main', 'intro', 'about'];
        for (var i in heros) {
          if (newHero === heros[i]) {
            $('#' + newHero).show('slow');
          }
          else {
           $('#' + heros[i]).hide('slow'); 
          }
        }
      }
    </script>

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


    <link rel="shortcut icon" type="image/x-icon" href="/static/img/favicon.png" />

    <script src="../static/js/jquery.min.js"></script>
  </head>

  <body style="background-image:url(http://placedog.com/1280/800);" onload="init();">

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner" style="background-color:rgba(238, 238, 238, .5);">
        <div class="container">
          <!-- <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a> -->
          <a class="brand" href="#" onclick="changeTo('intro');$('#homenav').toggleClass('active');$('#aboutnav').removeClass('active');" style="color:black;">SoundSculptor</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li id="homenav" class="active"><a href="#" onclick="changeTo('intro');$('#homenav').addClass('active');$('#aboutnav').removeClass('active');" style="color:black;">Home</a></li>
              <li id="aboutnav"><a href="#about" onclick="changeTo('about');$('#aboutnav').addClass('active');$('#homenav').removeClass('active');" style="color:black;">About</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
    
    <div class="container-fluid">
    
      <br/>
      <div class="row-fluid">
        <div class="hero-unit" style="background-color:rgba(238, 238, 238, .5);" id="intro">
            <center>
              <button class="btn btn-large btn-primary" style="width:60%;font-size:250%;height:120px;margin-left:auto;background-color:white;color:gray;" type="button" onclick="changeTo('main');">Start Sculpting!</button>
            <br/><br/>
            <hr style="background-color:rgba(238, 238, 238, .5);">
            <p>
              <a class="btn btn-primary btn-large" style="background-color:white;color:gray;" onClick="$('#video').toggle('slow');">
                Or view an example
              </a>
              <div id="video" style="display:none;">
                <br/>
                <button class="btn btn-large btn-primary" style="width:60%;font-size:250%;height:340px;margin-left:auto;background-color:white;color:gray;" type="button">VIDEO GOES HERE</button>
              </div>
            </p>
            </center>
        </div>

        <div class="hero-unit" style="background-color:rgba(238, 238, 238, .5);display:none;color:white;" id="about">
            <center>
              <h1 style="color:black;">About SoundSculptor</h1>
            <hr style="background-color:rgba(238, 238, 238, .5);">
            <p style="color:black;">
              Created using the Leap Motion, Web Audio, SoundCloud, and Dropbox APIs, SoundSculptor allows anyone to invent and record music on the spot just by using their hands. Upload your masterpiece to SoundCloud right after your sculpt it with simple hand motion.
            </p>
            <hr style="background-color:rgba(238, 238, 238, .5);">
            <p>
              <div class="row-fluid"/>
              
               <div class="span4"></div>

               <div class="span1">
                <a href="http://developers.soundcloud.com/"><img src="../static/img/soundcloud.png"></a>
               </div>
             
              <div class="span1">
               <a href="https://developers.facebook.com/"><img src="../static/img/facebook.png"></a>
              </div>

              <div class="span1">
               <a href="https://www.dropbox.com/developers"><img src="../static/img/dropbox.png"></a>
              </div>
              <div class="span1">
               <a href="https://devcenter.heroku.com/"><img src="../static/img/heroku.png"></a>
              </div>

              <div class="span4"></div>

            </center>
            </p><a href="#" onclick="$('#exportModal').modal('show');">Export</a>
        </div>


        <div class="hero-unit" style="background-color:rgba(238, 238, 238, .5);display:none;color:white;" id="main">
            <canvas id="interfaceCanvas" width="960" height="400" style="background: #333333;"></canvas>
        </div>
      </div>
    
        <div id="exportModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="exportModal" aria-hidden="true">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h3>Share your song!</h3>
            </div>
            <div class="modal-body">
              <a href="#" onclick="soundCloudAuth();"><div id="sc"><img src="../static/img/connectwithsc.png" alt="connect with SoundCloud"></div></a>
              <p>Save to Dropbox!</p>
              <p>Make a new song!</p>
            </div>
            <div class="modal-footer">
              <a href="#" onclick="$('#exportModal').modal('hide');" class="btn">Close</a>
              <a href="#" class="btn btn-primary">Save changes</a>
            </div>
        </div>


    </div> <!-- /container -->
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/leap.js"></script>
    <script src="http://connect.soundcloud.com/sdk.js"></script>
    <script>
      var latestFrame = null;
      var i = 0;
      Leap.loop(function(frame) {
        latestFrame = frame;
        var pointables = new Array();
        for (var i = 0; i < latestFrame.pointables.length; i++) {
          var coords = {};
          var pos = (latestFrame.pointables)[i].tipPosition;
          coords['x'] = pos[0];
          coords['y'] = pos[1];
          coords['z'] = pos[2];
          pointables[i] = coords;
        }
        handleLeapMove(pointables);
        // var stringed = "";
        // for (var i in pointables) {
        //   stringed += JSON.stringify(pointables[i]);
        // }
        // $('#output').text(stringed);
      })
    </script>
    <script type="text/javascript" src="http://code.createjs.com/easeljs-0.5.0.min.js"></script>
    <script type="text/javascript" src="http://code.createjs.com/tweenjs-0.3.0.min.js"></script>

    <script>
        var canvas;
        var stage;
        // var tweens;
        // var activeCount;
        var circleCount = 20;
        var text;
        var pointerVisuals = [];

        function PointerVisual(coords) {
          this.tweens = [];
          this.activeCount = circleCount;

          this.tweenComplete = function() {
            this.activeCount--;
          }

          this.moveTo = function(coords) {
            console.log("moving to: ");
            console.log(coords);

            for (var i=0; i<circleCount; i++) {
              var ref = this.tweens[i].ref;
              var tween = this.tweens[i].tween;
              createjs.Tween.get(ref,{override:true}).to({x:coords.x,y:coords.y}, (0.5+i*0.12)*1000, createjs.Ease.elasticOut).call($.proxy(this.tweenComplete, this));
            }
            this.activeCount = circleCount;
          }

          //make the concentric circles:
          for (var i=0; i<circleCount; i++) {
              // draw the circle, and put it on stage:
              var circle = new createjs.Shape();
              circle.graphics.setStrokeStyle(15);
              circle.graphics.beginStroke("#113355");
              circle.graphics.drawCircle(0,0,(i+1)*4);
              circle.alpha = 1-i*0.02;
              circle.x = coords.x;
              circle.y = coords.y;
              circle.compositeOperation = "lighter";

              var tween = createjs.Tween.get(circle).to({x:circle.x,y:circle.y}, (0.5+i*0.12)*1000, createjs.Ease.elasticOut).call($.proxy(this.tweenComplete, this));
              this.tweens.push({tween:tween, ref:circle});
              stage.addChild(circle);
          }

        }

        function init() {
          if (window.top != window) {
            document.getElementById("header").style.display = "none";
          }

          canvas = document.getElementById("interfaceCanvas");
          stage = new createjs.Stage(canvas);
          console.log('stage inited');
          stage.enableMouseOver(10);
          createjs.Touch.enable(stage);

          pointerVisuals = [
            new PointerVisual({'x': 275, 'y': 200}),
            new PointerVisual({'x': 475, 'y': 200}),
            new PointerVisual({'x': 275, 'y': 400}),
            new PointerVisual({'x': 475, 'y': 400})
          ];

          createjs.Ticker.addListener(window);
        }

        function handleLeapMove(leapCoords) {
          // var coordsArr = [
          //   {'x': stage.mouseX, 'y': stage.mouseY},
          //   {'x': stage.mouseX + 200, 'y': stage.mouseY},
          //   {'x': stage.mouseX, 'y': stage.mouseY + 200},
          //   {'x': stage.mouseX + 200, 'y': stage.mouseY + 200}
          // ];
          console.log('motion called');
          for(var i = 0; i < leapCoords.length; i++) {
            if(pointerVisuals[i]) {
              pointerVisuals[i].moveTo({'x': leapCoords[i].x, 'y': leapCoords[i].y});
            }
            else {
              pointerVisuals.push(new PointerVisual({'x': leapCoords[i].x, 'y': leapCoords[i].y}));
            }
          }
        }

        function tick() {
            if (pointerVisuals[0].activeCount) { 
              stage.update(); 
            }
        }


    </script>

    <script>
    function soundCloudAuth() {
      // initialize client with app credentials
      SC.initialize({
        client_id: 'c62653f616ed117b1d19068691b24234',
        redirect_uri: 'http://soundsculptor.herokuapp.com/callback'
      });

      // initiate auth popup
      SC.connect(function() {
        SC.get('/me', function(lme) { 
          $('#sc').html('Uploaded!');
          loggedIn = true;
          me = lme;
        });
        SC.record({
            start: function() {
              window.setTimeout(function() {
                SC.recordStop(); SC.recordUpload({track: { title: 'This is my sound' }});}, // put .wav file here or something
                5000);
            }
        });
      })
    }

    $.post('https://api.dropbox.com/1/oauth/request_token', function (data) {
      // oauth_token_secret=b9q1n5il4lcc&oauth_token=mh7an9dkrg59
      
    })
    </script>

  </body>
</html>
